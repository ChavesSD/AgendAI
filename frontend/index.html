<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AgendAI - Sistema inteligente de agendamento">
    <title>AgendAI - Sistema de Agendamento Inteligente</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/public/src/img/LogoAgendAI.png" type="image/png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Estilos Personalizados -->
    <link rel="stylesheet" href="/public/src/css/styles.css">

    <!-- Pré-carregamento de dependências importantes -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" as="script">
</head>
<body>
    <!-- Container principal da aplicação SPA -->
    <div id="app-content" class="app-container">
        <!-- O conteúdo será carregado dinamicamente aqui -->
        <div class="d-flex justify-content-center align-items-center min-vh-100">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <p class="mt-3">Carregando AgendAI...</p>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- Script para limpar dados mockados -->
    <script src="/public/src/js/reset-data.js"></script>
    
    <!-- Script global para o botão de logout -->
    <script>
        // Adicionar handler global para o botão de logout
        document.addEventListener('click', function(e) {
            const logoutButton = e.target.closest('#logout-button');
            if (logoutButton) {
                e.preventDefault();
                console.log('Botão de logout clicado (handler global)');
                
                // Limpar localStorage
                localStorage.removeItem('agendai_auth');
                console.log('Dados de autenticação removidos do localStorage');
                
                // Redirecionar para a página inicial
                window.location.href = '/';
                console.log('Redirecionando para a página inicial');
                
                // Forçar reload após pequeno delay
                setTimeout(() => {
                    window.location.reload();
                }, 100);
            }
        });
    </script>
    
    <!-- Script de inicialização para garantir que as dependências estejam carregadas -->
    <script>
        // Verificar se todas as dependências estão disponíveis
        window.AgendAIDependencies = {
            bootstrap: typeof bootstrap !== 'undefined',
            chart: typeof Chart !== 'undefined',
            jquery: typeof jQuery !== 'undefined'
        };
        
        // Função para carregar dependências faltantes
        function loadMissingDependencies(callback) {
            const requiredLibraries = [];
            
            // Verificar jQuery
            if (typeof jQuery === 'undefined') {
                console.log('jQuery não encontrado, carregando...');
                requiredLibraries.push({
                    name: 'jQuery',
                    src: 'https://code.jquery.com/jquery-3.7.1.min.js'
                });
            }
            
            // Verificar Bootstrap
            if (typeof bootstrap === 'undefined' || !bootstrap.Modal) {
                console.log('Bootstrap não encontrado, carregando...');
                requiredLibraries.push({
                    name: 'Bootstrap',
                    src: 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js'
                });
            }
            
            // Se todas as bibliotecas já estiverem carregadas
            if (requiredLibraries.length === 0) {
                console.log('Todas as bibliotecas já estão carregadas');
                if (callback) callback();
                return;
            }
            
            let librariesLoaded = 0;
            
            // Carregar as bibliotecas necessárias
            requiredLibraries.forEach(lib => {
                const script = document.createElement('script');
                script.src = lib.src;
                script.onload = () => {
                    console.log(`${lib.name} carregado com sucesso`);
                    librariesLoaded++;
                    
                    if (librariesLoaded === requiredLibraries.length) {
                        console.log('Todas as bibliotecas foram carregadas');
                        // Aguardar um pouco para garantir que as bibliotecas estejam inicializadas
                        setTimeout(() => {
                            if (callback) callback();
                        }, 100);
                    }
                };
                script.onerror = () => {
                    console.error(`Erro ao carregar ${lib.name}`);
                };
                document.head.appendChild(script);
            });
        }
        
        // Verificar dependências
        function checkDependencies() {
            console.log('Verificando dependências:', window.AgendAIDependencies);
            const allLoaded = Object.values(window.AgendAIDependencies).every(dep => dep === true);
            
            if (!allLoaded) {
                console.warn('Nem todas as dependências foram carregadas. Carregando automaticamente...');
                loadMissingDependencies(() => {
                    // Atualizar status de dependências
                    window.AgendAIDependencies = {
                        bootstrap: typeof bootstrap !== 'undefined',
                        chart: typeof Chart !== 'undefined',
                        jquery: typeof jQuery !== 'undefined'
                    };
                    
                    console.log('Dependências atualizadas:', window.AgendAIDependencies);
                    initApp();
                });
                return false;
            }
            
            console.log('Todas as dependências carregadas. Inicializando aplicativo...');
            return true;
        }
        
        // Função para inicializar o aplicativo
        function initApp() {
            if (checkDependencies()) {
                // Carregar o aplicativo principal
                const scriptApp = document.createElement('script');
                scriptApp.src = '/public/src/js/app.js';
                scriptApp.onload = () => {
                    console.log('App.js carregado com sucesso');
                    
                    // Carregar o script de correção de autenticação após o app.js
                    const scriptFixAuth = document.createElement('script');
                    scriptFixAuth.src = '/public/src/js/fix-auth.js';
                    scriptFixAuth.onload = () => {
                        console.log('Script de correção de autenticação carregado com sucesso');
                        
                        // Carregar o script de correção do modal de empresa
                        const scriptFixCompanyModal = document.createElement('script');
                        scriptFixCompanyModal.src = '/public/src/js/fix-company-modal.js';
                        scriptFixCompanyModal.onload = () => console.log('Script de correção do modal de empresa carregado com sucesso');
                        scriptFixCompanyModal.onerror = (e) => console.error('Erro ao carregar script de correção do modal de empresa:', e);
                        document.body.appendChild(scriptFixCompanyModal);
                    };
                    scriptFixAuth.onerror = (e) => console.error('Erro ao carregar script de correção de autenticação:', e);
                    document.body.appendChild(scriptFixAuth);
                };
                scriptApp.onerror = (e) => console.error('Erro ao carregar app.js:', e);
                document.body.appendChild(scriptApp);
            }
        }
        
        // Iniciar carregamento quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <!-- Script de correção para botões de exclusão de planos -->
    <script src="/public/js/plan-actions-fix.js"></script>
    
    <!-- Script de diagnóstico e correção de problemas de conexão -->
    <script src="/public/js/connection-fix.js"></script>
</body>
</html> 
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Realize seu agendamento online de forma simples e rápida">
    <title>Agendamento Online - AgendAI</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/src/css/styles.css">
    <link rel="stylesheet" href="/src/css/booking.css">
    
    <!-- Favicon -->
    <link rel="icon" href="/src/img/LogoAgendAIForHeader.png" type="image/png">
    
    <!-- Script de inicialização rápida -->
    <script>
        // Função para verificar se o modal já foi exibido
        function jaExibiuModal() {
            return localStorage.getItem('welcome_modal_exibido') === 'true';
        }
        
        // Função para marcar o modal como exibido
        function marcarModalExibido() {
            localStorage.setItem('welcome_modal_exibido', 'true');
        }
        
        // Função para corrigir a URL se tiver hash
        if (window.location.hash) {
            console.log('Detectado hash na URL. Corrigindo...');
            const cleanUrl = window.location.href.split('#')[0];
            window.history.replaceState({}, document.title, cleanUrl);
            console.log('URL corrigida para:', cleanUrl);
        }
        
        // Função para exibir o modal assim que for possível
        function initWelcomeModal() {
            console.log('Inicialização rápida do modal está sendo configurada...');
            
            // Verifica se o modal já foi exibido
            if (jaExibiuModal()) {
                console.log('Modal já foi exibido anteriormente, não exibindo novamente.');
                return;
            }
            
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                showWelcomeModalDirectly();
            } else {
                document.addEventListener('DOMContentLoaded', showWelcomeModalDirectly);
            }
            
            // Garantir que o modal seja exibido mesmo que DOMContentLoaded já tenha ocorrido
            setTimeout(showWelcomeModalDirectly, 3000);
        }
        
        function showWelcomeModalDirectly() {
            // Não mostrar se já foi exibido
            if (jaExibiuModal()) {
                return;
            }
            
            console.log('Tentando exibir modal via inicialização rápida...');
            setTimeout(function() {
                try {
                    if (typeof bootstrap !== 'undefined') {
                        const welcomeModalElement = document.getElementById('welcome-modal');
                        if (welcomeModalElement) {
                            const modal = new bootstrap.Modal(welcomeModalElement);
                            modal.show();
                            console.log('Modal exibido via inicialização rápida!');
                            
                            // Marca o modal como exibido
                            marcarModalExibido();
                        }
                    }
                } catch (e) {
                    console.error('Erro na inicialização rápida:', e);
                }
            }, 1500);
        }
        
        // Iniciar o processo
        initWelcomeModal();
    </script>
</head>
<body class="booking-page">
    <!-- Cabeçalho personalizado da empresa -->
    <header id="company-header" class="py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6 mb-3 mb-md-0">
                    <div class="d-flex align-items-center">
                        <div class="company-logo-container me-3">
                            <img src="/src/img/company-placeholder.png" alt="Logo da Empresa" id="company-logo" class="company-logo">
                        </div>
                        <div>
                            <h1 id="company-name" class="h3 mb-0">Nome da Empresa</h1>
                            <p id="company-category" class="text-muted mb-0">Categoria da Empresa</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="company-info text-md-end">
                        <p class="mb-1"><i class="fas fa-map-marker-alt me-2"></i><span id="company-address">Endereço da Empresa</span></p>
                        <p class="mb-1"><i class="fas fa-phone-alt me-2"></i><span id="company-phone">(00) 00000-0000</span></p>
                        <p class="mb-0"><i class="fas fa-envelope me-2"></i><span id="company-email">contato@empresa.com</span></p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Conteúdo principal -->
    <main class="py-5">
        <div class="container">
            <div class="booking-progress mb-5">
                <div class="row">
                    <div class="col-12">
                        <div class="progress-container">
                            <ul class="progress-steps">
                                <li class="active" data-step="1">
                                    <div class="step-icon"><i class="fas fa-user-md"></i></div>
                                    <span class="step-label">Profissional</span>
                                </li>
                                <li data-step="2">
                                    <div class="step-icon"><i class="fas fa-list"></i></div>
                                    <span class="step-label">Serviço</span>
                                </li>
                                <li data-step="3">
                                    <div class="step-icon"><i class="fas fa-calendar-alt"></i></div>
                                    <span class="step-label">Data/Hora</span>
                                </li>
                                <li data-step="4">
                                    <div class="step-icon"><i class="fas fa-check-circle"></i></div>
                                    <span class="step-label">Confirmação</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Container do conteúdo do agendamento -->
            <div class="booking-container">
                <!-- Step 1: Seleção de Profissional -->
                <div class="booking-step active" id="step-1">
                    <div class="step-header">
                        <h2>Escolha um profissional</h2>
                        <p class="text-muted">Selecione o profissional de sua preferência para realizar o atendimento</p>
                    </div>
                    
                    <div class="row professionals-container" id="professionals-list">
                        <!-- Profissionais serão renderizados aqui dinamicamente -->
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="professional-card" data-professional-id="1">
                                <div class="professional-image">
                                    <img src="/src/img/professionals/prof1.jpg" alt="João Silva">
                                </div>
                                <div class="professional-info">
                                    <h3 class="professional-name">João Silva</h3>
                                    <p class="professional-title">Cabeleireiro</p>
                                    <div class="professional-rating">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                        <span>4.5 (120 avaliações)</span>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 mt-3 select-professional">Selecionar</button>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="professional-card" data-professional-id="2">
                                <div class="professional-image">
                                    <img src="/src/img/professionals/prof2.jpg" alt="Maria Oliveira">
                                </div>
                                <div class="professional-info">
                                    <h3 class="professional-name">Maria Oliveira</h3>
                                    <p class="professional-title">Cabeleireira e Maquiadora</p>
                                    <div class="professional-rating">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <span>5.0 (85 avaliações)</span>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 mt-3 select-professional">Selecionar</button>
                            </div>
                        </div>
                        
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="professional-card" data-professional-id="3">
                                <div class="professional-image">
                                    <img src="/src/img/professionals/prof3.jpg" alt="Carlos Santos">
                                </div>
                                <div class="professional-info">
                                    <h3 class="professional-name">Carlos Santos</h3>
                                    <p class="professional-title">Barbeiro</p>
                                    <div class="professional-rating">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <span>4.0 (65 avaliações)</span>
                                    </div>
                                </div>
                                <button class="btn btn-primary w-100 mt-3 select-professional">Selecionar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: Seleção de Serviço -->
                <div class="booking-step" id="step-2">
                    <div class="step-header">
                        <h2>Escolha um serviço</h2>
                        <p class="text-muted">Selecione um ou mais serviços que deseja agendar com <span id="selected-professional-name">o profissional</span></p>
                    </div>
                    
                    <div class="services-container" id="services-list">
                        <!-- Serviços serão renderizados aqui dinamicamente -->
                        <div class="service-card" data-service-id="1">
                            <div class="service-info">
                                <h3 class="service-name">Corte de Cabelo</h3>
                                <p class="service-description">Corte profissional personalizado de acordo com o seu estilo.</p>
                                <div class="service-details">
                                    <span class="service-duration"><i class="far fa-clock me-1"></i> 30 min</span>
                                    <span class="service-price">R$ 50,00</span>
                                </div>
                            </div>
                            <div class="service-action">
                                <button class="btn btn-outline-primary select-service">Selecionar</button>
                            </div>
                        </div>
                        
                        <div class="service-card" data-service-id="2">
                            <div class="service-info">
                                <h3 class="service-name">Hidratação</h3>
                                <p class="service-description">Tratamento para restaurar a hidratação dos fios e melhorar a aparência do cabelo.</p>
                                <div class="service-details">
                                    <span class="service-duration"><i class="far fa-clock me-1"></i> 45 min</span>
                                    <span class="service-price">R$ 70,00</span>
                                </div>
                            </div>
                            <div class="service-action">
                                <button class="btn btn-outline-primary select-service">Selecionar</button>
                            </div>
                        </div>
                        
                        <div class="service-card" data-service-id="3">
                            <div class="service-info">
                                <h3 class="service-name">Coloração</h3>
                                <p class="service-description">Coloração profissional com produtos de alta qualidade.</p>
                                <div class="service-details">
                                    <span class="service-duration"><i class="far fa-clock me-1"></i> 1h 30min</span>
                                    <span class="service-price">R$ 120,00</span>
                                </div>
                            </div>
                            <div class="service-action">
                                <button class="btn btn-outline-primary select-service">Selecionar</button>
                            </div>
                        </div>
                        
                        <div class="service-card" data-service-id="4">
                            <div class="service-info">
                                <h3 class="service-name">Barba</h3>
                                <p class="service-description">Corte e modelagem de barba com toalha quente e produtos especiais.</p>
                                <div class="service-details">
                                    <span class="service-duration"><i class="far fa-clock me-1"></i> 30 min</span>
                                    <span class="service-price">R$ 40,00</span>
                                </div>
                            </div>
                            <div class="service-action">
                                <button class="btn btn-outline-primary select-service">Selecionar</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Exibição do total de serviços selecionados -->
                    <div class="services-summary mt-4">
                        <div class="card shadow-sm">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1">Resumo</h5>
                                    <p class="mb-0 text-muted small">Clique novamente em um serviço para remover</p>
                                </div>
                                <div class="text-end">
                                    <h4 class="text-primary mb-0" id="total-price">Total: R$ 0,00</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3: Seleção de Data e Hora -->
                <div class="booking-step" id="step-3">
                    <div class="step-header">
                        <h2>Escolha a data e horário</h2>
                        <p class="text-muted">Selecione quando deseja agendar <span id="selected-service-name">seu serviço</span> com <span id="selected-professional-name-2">o profissional</span></p>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-5 mb-4">
                            <div class="calendar-container" id="booking-calendar">
                                <!-- Calendário será renderizado aqui -->
                                <div class="calendar-header">
                                    <button class="btn btn-link text-dark" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                    <h3 id="current-month">Maio 2024</h3>
                                    <button class="btn btn-link text-dark" id="next-month"><i class="fas fa-chevron-right"></i></button>
                                </div>
                                <div class="calendar-weekdays">
                                    <div>Dom</div>
                                    <div>Seg</div>
                                    <div>Ter</div>
                                    <div>Qua</div>
                                    <div>Qui</div>
                                    <div>Sex</div>
                                    <div>Sáb</div>
                                </div>
                                <div class="calendar-days" id="calendar-days">
                                    <!-- Dias do calendário serão renderizados aqui -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-7">
                            <div class="time-slots-container">
                                <h4 id="selected-date-display">Selecione uma data para ver os horários disponíveis</h4>
                                <div class="time-slots" id="time-slots">
                                    <!-- Horários serão renderizados aqui -->
                                    <div class="time-slot-placeholder">
                                        <p class="text-center">Selecione uma data no calendário para ver os horários disponíveis</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Confirmação -->
                <div class="booking-step" id="step-4">
                    <div class="step-header">
                        <h2>Confirme seu agendamento</h2>
                        <p class="text-muted">Revise os detalhes e confirme seu agendamento</p>
                    </div>
                    
                    <div class="confirmation-container">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h3 class="card-title mb-0">Resumo do Agendamento</h3>
                            </div>
                            <div class="card-body">
                                <div class="confirmation-details">
                                    <div class="detail-item">
                                        <span class="detail-label"><i class="fas fa-user-md me-2"></i> Profissional:</span>
                                        <span class="detail-value" id="confirm-professional">João Silva</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label"><i class="fas fa-list me-2"></i> Serviços:</span>
                                        <span class="detail-value" id="confirm-services">Corte de Cabelo</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label"><i class="far fa-calendar me-2"></i> Data:</span>
                                        <span class="detail-value" id="confirm-date">15/05/2024</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label"><i class="far fa-clock me-2"></i> Horário:</span>
                                        <span class="detail-value" id="confirm-time">14:30</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label"><i class="fas fa-hourglass-half me-2"></i> Duração total:</span>
                                        <span class="detail-value" id="confirm-duration">30 minutos</span>
                                    </div>
                                    <div class="detail-item border-top mt-3 pt-3">
                                        <span class="detail-label"><i class="fas fa-tag me-2"></i> Valor total:</span>
                                        <span class="detail-value" id="confirm-price">R$ 50,00</span>
                                    </div>
                                </div>
                                
                                <div class="customer-info mt-4">
                                    <h4>Seus dados</h4>
                                    <form id="customer-form">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="customer-name" class="form-label">Nome completo</label>
                                                <input type="text" class="form-control" id="customer-name" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="customer-phone" class="form-label">Telefone</label>
                                                <input type="tel" class="form-control" id="customer-phone" placeholder="(00) 00000-0000" required>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="customer-email" class="form-label">E-mail</label>
                                            <input type="email" class="form-control" id="customer-email" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="customer-notes" class="form-label">Observações (opcional)</label>
                                            <textarea class="form-control" id="customer-notes" rows="3"></textarea>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Navegação entre passos -->
                <div class="booking-navigation mt-4">
                    <button class="btn btn-outline-secondary" id="prev-step" disabled>
                        <i class="fas fa-arrow-left me-1"></i> Voltar
                    </button>
                    <button class="btn btn-primary" id="next-step">
                        Continuar <i class="fas fa-arrow-right ms-1"></i>
                    </button>
                    <button class="btn btn-success" id="confirm-booking" style="display: none;">
                        Confirmar Agendamento <i class="fas fa-check ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer class="py-4 bg-light">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 <span id="footer-company-name">Nome da Empresa</span>. Todos os direitos reservados.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        Desenvolvido com <i class="fas fa-heart text-danger"></i> por <a href="#" class="text-decoration-none">AgendAI</a>
                        <!-- Botão para resetar o modal (apenas para testes) -->
                        <small><a href="#" onclick="localStorage.removeItem('welcome_modal_exibido'); window.location.reload(); return false;" class="ms-2 text-muted"><i class="fas fa-redo"></i> Resetar Modal</a></small>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Boas-vindas -->
    <div class="modal fade" id="welcome-modal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="welcomeModalLabel">Bem-vindo ao Agendamento Online</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="welcome-icon me-3">
                            <i class="fas fa-robot fa-3x text-primary"></i>
                        </div>
                        <div>
                            <h4 class="mb-1">Olá, sou o AgendAI!</h4>
                            <p class="text-muted mb-0">Assistente de agendamentos da <span id="welcome-company-name">Nome da Empresa</span>.</p>
                        </div>
                    </div>
                    
                    <p>Estou aqui para ajudar você a agendar seu serviço de forma rápida e simples. Siga estas etapas:</p>
                    
                    <div class="welcome-steps">
                        <div class="welcome-step d-flex align-items-center mb-2">
                            <div class="welcome-step-number bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">1</div>
                            <div>Escolha o profissional de sua preferência</div>
                        </div>
                        <div class="welcome-step d-flex align-items-center mb-2">
                            <div class="welcome-step-number bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">2</div>
                            <div>Selecione o serviço desejado</div>
                        </div>
                        <div class="welcome-step d-flex align-items-center mb-2">
                            <div class="welcome-step-number bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">3</div>
                            <div>Escolha a data e horário disponíveis</div>
                        </div>
                        <div class="welcome-step d-flex align-items-center">
                            <div class="welcome-step-number bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">4</div>
                            <div>Confirme seus dados para finalizar</div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i> Em caso de dúvidas, entre em contato pelo telefone <strong id="welcome-phone">(00) 00000-0000</strong> ou email <strong id="welcome-email">contato@empresa.com</strong>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="localStorage.setItem('welcome_modal_exibido', 'true');">Começar Agendamento</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="confirmation-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Agendamento Confirmado!</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="confirmation-icon mb-4">
                        <i class="fas fa-check-circle fa-5x text-success"></i>
                    </div>
                    <h4>Seu agendamento foi realizado com sucesso!</h4>
                    <p>Enviamos os detalhes para o seu e-mail.</p>
                    <div class="confirmation-code mt-3 mb-3">
                        <p class="mb-1">Código de confirmação:</p>
                        <h5 id="booking-code">ABC123456</h5>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/src/js/booking.js"></script>
    <script>
        // Script final para garantir que o modal seja exibido
        window.addEventListener('load', function() {
            console.log('Janela completamente carregada, última tentativa de exibir o modal...');
            
            // Verifica se o modal já foi exibido
            if (localStorage.getItem('welcome_modal_exibido') === 'true') {
                console.log('Modal já foi exibido anteriormente, não exibindo novamente.');
                return;
            }
            
            setTimeout(function() {
                try {
                    const welcomeModalElement = document.getElementById('welcome-modal');
                    if (welcomeModalElement && typeof bootstrap !== 'undefined') {
                        // Forçar a abertura direta do modal
                        welcomeModalElement.classList.add('show');
                        welcomeModalElement.style.display = 'block';
                        document.body.classList.add('modal-open');
                        
                        // Criar backdrop manualmente se necessário
                        if (!document.querySelector('.modal-backdrop')) {
                            const backdrop = document.createElement('div');
                            backdrop.className = 'modal-backdrop fade show';
                            document.body.appendChild(backdrop);
                        }
                        
                        // Marcar como exibido
                        localStorage.setItem('welcome_modal_exibido', 'true');
                        
                        console.log('Modal forçado manualmente!');
                    }
                } catch (e) {
                    console.error('Erro na última tentativa:', e);
                }
            }, 3000);
            
            // Garantir que os botões de navegação não reexibam o modal
            document.querySelectorAll('#prev-step, #next-step, #confirm-booking').forEach(function(button) {
                button.addEventListener('click', function() {
                    localStorage.setItem('welcome_modal_exibido', 'true');
                });
            });
        });
    </script>
</body>
</html> 
<!-- View de Gestão de Profissionais para o Dashboard Administrativo -->
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="border-end bg-white" id="sidebar-wrapper">
        <div class="sidebar-heading bg-primary text-white py-4 d-flex justify-content-center">
            <div class="logo-container">
                <img src="/public/src/img/LogoAgendAIForFooter.png" alt="AgendAI Logo" class="logo-medium">
            </div>
        </div>
        <div class="list-group list-group-flush">
            <a href="#/admin" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
            </a>
            <a href="#/admin/plans" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-tag me-2"></i> Planos
            </a>
            <a href="#/admin/companies" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-building me-2"></i> Empresas
            </a>
            <a href="#/admin/users" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-users me-2"></i> Usuários
            </a>
            <a href="#/admin/professionals" class="list-group-item list-group-item-action active" data-link>
                <i class="fas fa-user-md me-2"></i> Profissionais
            </a>
            <a href="#/admin/services" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-list-alt me-2"></i> Serviços
            </a>
            <a href="#/admin/clients" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-user-friends me-2"></i> Clientes
            </a>
            <a href="#/admin/appointments" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-calendar-alt me-2"></i> Agendamentos
            </a>
            <a href="#/admin/reports" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-chart-bar me-2"></i> Relatórios
            </a>
            <a href="#/admin/settings" class="list-group-item list-group-item-action" data-link>
                <i class="fas fa-cog me-2"></i> Configurações
            </a>
        </div>
    </div>
    
    <!-- Page Content -->
    <div id="page-content-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                        <li class="nav-item">
                            <button class="btn btn-outline-secondary btn-sm mt-1" id="logout-button">
                                <i class="fas fa-sign-out-alt me-1"></i> Sair
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <!-- Professionals Content -->
        <div class="container-fluid p-4">
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2 class="mb-3">Gestão de Profissionais</h2>
                    <p class="text-muted">Cadastre e gerencie os profissionais que prestam serviços nas empresas cadastradas.</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProfessionalModal">
                        <i class="fas fa-plus me-1"></i> Novo Profissional
                    </button>
                </div>
            </div>
            
            <!-- Filtros -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Filtros</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="filterName" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="filterName" placeholder="Nome do profissional">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="filterCompany" class="form-label">Empresa</label>
                            <select class="form-select" id="filterCompany">
                                <option value="">Todas</option>
                                <!-- Empresas serão carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="filterSpecialty" class="form-label">Especialidade</label>
                            <select class="form-select" id="filterSpecialty">
                                <option value="">Todas</option>
                                <!-- Especialidades serão carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="filterStatus" class="form-label">Status</label>
                            <select class="form-select" id="filterStatus">
                                <option value="">Todos</option>
                                <option value="active">Ativo</option>
                                <option value="inactive">Inativo</option>
                                <option value="vacation">Em férias</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-end">
                            <button type="button" class="btn btn-secondary me-2" id="clearFiltersBtn">
                                <i class="fas fa-eraser me-1"></i> Limpar
                            </button>
                            <button type="button" class="btn btn-primary" id="applyFiltersBtn">
                                <i class="fas fa-search me-1"></i> Filtrar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Professionals Table -->
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Profissionais Cadastrados</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Opções:</div>
                            <a class="dropdown-item" href="#"><i class="fas fa-file-excel me-2"></i> Exportar Excel</a>
                            <a class="dropdown-item" href="#"><i class="fas fa-file-pdf me-2"></i> Exportar PDF</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#"><i class="fas fa-sync-alt me-2"></i> Atualizar</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="professionalsTable" width="100%" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Empresa</th>
                                    <th>Especialidades</th>
                                    <th>Telefone</th>
                                    <th>Status</th>
                                    <th>Data de Cadastro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="professionalsTable">
                                <!-- Dados serão carregados dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Anterior</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Próximo</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Adicionar Profissional -->
<div class="modal fade" id="addProfessionalModal" tabindex="-1" aria-labelledby="addProfessionalModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="addProfessionalModalLabel">Novo Profissional</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="professionalForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="professionalName" class="form-label">Nome Completo*</label>
                            <input type="text" class="form-control" id="professionalName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="professionalEmail" class="form-label">Email*</label>
                            <input type="email" class="form-control" id="professionalEmail" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="professionalCompany" class="form-label">Empresa*</label>
                            <select class="form-select" id="professionalCompany" required>
                                <option value="">Selecione uma empresa</option>
                                <!-- As empresas serão carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="professionalPhone" class="form-label">Telefone*</label>
                            <input type="tel" class="form-control" id="professionalPhone" placeholder="(99) 99999-9999" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="professionalStatus" class="form-label">Status*</label>
                            <select class="form-select" id="professionalStatus" required>
                                <option value="active">Ativo</option>
                                <option value="inactive">Inativo</option>
                                <option value="vacation">Em férias</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="professionalDocument" class="form-label">CPF/CNPJ</label>
                            <input type="text" class="form-control" id="professionalDocument" placeholder="Somente números">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Especialidades*</label>
                        <div class="card">
                            <div class="card-body">
                                <div id="specialtiesContainer" class="row">
                                    <!-- As especialidades serão carregadas dinamicamente -->
                                </div>
                                <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addSpecialtyBtn">
                                    <i class="fas fa-plus me-1"></i> Adicionar especialidade
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="professionalDescription" class="form-label">Descrição do Profissional</label>
                        <textarea class="form-control" id="professionalDescription" rows="3" placeholder="Breve descrição sobre o profissional e sua experiência"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Horários de Atendimento</label>
                        <div class="card">
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workMonday">
                                            <label class="form-check-label" for="workMonday">Segunda-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="mondayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="mondayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workTuesday">
                                            <label class="form-check-label" for="workTuesday">Terça-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="tuesdayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="tuesdayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workWednesday">
                                            <label class="form-check-label" for="workWednesday">Quarta-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="wednesdayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="wednesdayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workThursday">
                                            <label class="form-check-label" for="workThursday">Quinta-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="thursdayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="thursdayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workFriday">
                                            <label class="form-check-label" for="workFriday">Sexta-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="fridayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="fridayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workSaturday">
                                            <label class="form-check-label" for="workSaturday">Sábado</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="saturdayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="saturdayEnd" value="12:00">
                                        </div>
                                    </div>
                                </div>
                                <div class="row g-3 mt-1">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="workSunday">
                                            <label class="form-check-label" for="workSunday">Domingo</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="sundayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="sundayEnd" value="12:00">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="professionalPhoto" class="form-label">Foto do Profissional</label>
                        <input type="file" class="form-control" id="professionalPhoto" accept="image/*">
                        <div class="form-text">Formato recomendado: quadrado, JPG, PNG (máx. 2MB)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveProfessionalBtn">Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Editar Profissional -->
<div class="modal fade" id="editProfessionalModal" tabindex="-1" aria-labelledby="editProfessionalModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="editProfessionalModalLabel">Editar Profissional</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editProfessionalForm">
                    <input type="hidden" id="editProfessionalId" value="">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editProfessionalName" class="form-label">Nome Completo*</label>
                            <input type="text" class="form-control" id="editProfessionalName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="editProfessionalEmail" class="form-label">Email*</label>
                            <input type="email" class="form-control" id="editProfessionalEmail" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editProfessionalCompany" class="form-label">Empresa*</label>
                            <select class="form-select" id="editProfessionalCompany" required>
                                <option value="">Selecione uma empresa</option>
                                <!-- As empresas serão carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editProfessionalPhone" class="form-label">Telefone*</label>
                            <input type="tel" class="form-control" id="editProfessionalPhone" placeholder="(99) 99999-9999" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editProfessionalStatus" class="form-label">Status*</label>
                            <select class="form-select" id="editProfessionalStatus" required>
                                <option value="active">Ativo</option>
                                <option value="inactive">Inativo</option>
                                <option value="vacation">Em férias</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editProfessionalDocument" class="form-label">CPF/CNPJ</label>
                            <input type="text" class="form-control" id="editProfessionalDocument" placeholder="Somente números">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Especialidades*</label>
                        <div class="card">
                            <div class="card-body">
                                <div id="editSpecialtiesContainer" class="row">
                                    <!-- As especialidades serão carregadas dinamicamente -->
                                </div>
                                <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="editAddSpecialtyBtn">
                                    <i class="fas fa-plus me-1"></i> Adicionar especialidade
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editProfessionalDescription" class="form-label">Descrição do Profissional</label>
                        <textarea class="form-control" id="editProfessionalDescription" rows="3" placeholder="Breve descrição sobre o profissional e sua experiência"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Horários de Atendimento</label>
                        <div class="card">
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editWorkMonday">
                                            <label class="form-check-label" for="editWorkMonday">Segunda-feira</label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text">De</span>
                                            <input type="time" class="form-control" id="editMondayStart" value="08:00">
                                            <span class="input-group-text">até</span>
                                            <input type="time" class="form-control" id="editMondayEnd" value="18:00">
                                        </div>
                                    </div>
                                </div>
                                <!-- Demais dias da semana (o mesmo padrão que o modal de adicionar) -->
                                <!-- ... -->
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editProfessionalPhoto" class="form-label">Foto do Profissional</label>
                        <input type="file" class="form-control" id="editProfessionalPhoto" accept="image/*">
                        <div class="form-text">Formato recomendado: quadrado, JPG, PNG (máx. 2MB)</div>
                        <div class="mt-2">
                            <img id="editProfessionalPhotoPreview" src="" alt="Foto do profissional" class="img-thumbnail d-none" style="max-width: 100px;">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="updateProfessionalBtn">Atualizar</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Dados dos profissionais (simulação do banco de dados)
    if (typeof window.professionals === 'undefined') {
        window.professionals = [];
    }

    // Lista de serviços/especialidades disponíveis
    if (typeof window.services === 'undefined') {
        window.services = [];
    }

    // Dados simulados de empresas
    if (typeof window.companies === 'undefined') {
        window.companies = [];
    }

    // Inicialização da página
    document.addEventListener('DOMContentLoaded', function() {
        // Configurar o botão de logout
        const logoutButton = document.getElementById('logout-button');
        if (logoutButton) {
            logoutButton.onclick = function(e) {
                e.preventDefault();
                console.log('Botão de logout clicado');
                
                // Limpar localStorage diretamente
                localStorage.removeItem('agendai_auth');
                console.log('Dados de autenticação removidos do localStorage');
                
                // Redirecionar para a página de login
                window.location.href = "/";
                console.log('Redirecionando para a página inicial');
            };
        } else {
            console.error('Botão de logout não encontrado no DOM');
        }

        // Inicialização da página de profissionais
        initProfessionalsPage();
    });

    // Função principal de inicialização
    function initProfessionalsPage() {
        console.log('Página de profissionais inicializada!');
        
        // Carregar empresas nos selects
        loadCompanies();
        
        // Carregar especialidades
        loadSpecialties();
        
        // Preencher a tabela com dados
        populateProfessionalsTable();
        
        // Configurar eventos
        setupEventListeners();
        
        // Tentar carregar profissionais e serviços do localStorage
        loadFromStorage();
    }

    // Carregar profissionais e serviços do localStorage
    function loadFromStorage() {
        try {
            // Carregar profissionais
            const storedProfessionals = localStorage.getItem('agendai_professionals');
            if (storedProfessionals) {
                window.professionals = JSON.parse(storedProfessionals);
                console.log('Profissionais carregados do localStorage:', window.professionals.length);
                populateProfessionalsTable();
            } else {
                // Salvar os profissionais padrão no localStorage
                saveProfessionalsToStorage();
            }
            
            // Carregar serviços/especialidades
            const storedServices = localStorage.getItem('agendai_services');
            if (storedServices) {
                window.services = JSON.parse(storedServices);
                console.log('Serviços carregados do localStorage:', window.services.length);
                loadSpecialties();
            } else {
                // Salvar os serviços padrão no localStorage
                saveServicesToStorage();
            }
        } catch (error) {
            console.error('Erro ao carregar dados do localStorage:', error);
        }
    }

    // Salvar profissionais no localStorage
    function saveProfessionalsToStorage() {
        try {
            localStorage.setItem('agendai_professionals', JSON.stringify(window.professionals));
            console.log('Profissionais salvos no localStorage:', window.professionals.length);
        } catch (error) {
            console.error('Erro ao salvar profissionais no localStorage:', error);
        }
    }

    // Salvar serviços no localStorage
    function saveServicesToStorage() {
        try {
            localStorage.setItem('agendai_services', JSON.stringify(window.services));
            console.log('Serviços salvos no localStorage:', window.services.length);
        } catch (error) {
            console.error('Erro ao salvar serviços no localStorage:', error);
        }
    }

    // Carregar empresas nos selects
    function loadCompanies() {
        const selects = [
            document.getElementById('filterCompany'),
            document.getElementById('professionalCompany'),
            document.getElementById('editProfessionalCompany')
        ];
        
        // Tentar obter empresas do localStorage
        let storedCompanies = [];
        try {
            const companiesData = localStorage.getItem('agendai_companies');
            if (companiesData) {
                storedCompanies = JSON.parse(companiesData);
            }
        } catch (error) {
            console.error('Erro ao carregar empresas do localStorage:', error);
        }
        
        // Se não houver empresas no localStorage, usar as empresas simuladas
        const companiesToUse = storedCompanies.length > 0 ? storedCompanies : window.companies;
        
        // Preencher os selects
        selects.forEach(select => {
            if (!select) return;
            
            // Limpar opções atuais, exceto a primeira
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Adicionar as empresas como opções
            companiesToUse.forEach(company => {
                if (company.status !== 'inactive') {
                    const option = document.createElement('option');
                    option.value = company.id;
                    option.textContent = company.name;
                    select.appendChild(option);
                }
            });
        });
        
        console.log('Empresas carregadas nos selects.');
    }

    // Carregar especialidades nos selects e containers
    function loadSpecialties() {
        const specialtySelect = document.getElementById('filterSpecialty');
        
        // Limpar o select de especialidades, exceto a primeira opção
        if (specialtySelect) {
            while (specialtySelect.options.length > 1) {
                specialtySelect.remove(1);
            }
            
            // Adicionar as especialidades como opções
            window.services.forEach(service => {
                const option = document.createElement('option');
                option.value = service.id;
                option.textContent = service.name;
                specialtySelect.appendChild(option);
            });
        }
        
        // Carregar as especialidades no modal de adicionar
        const specialtiesContainer = document.getElementById('specialtiesContainer');
        if (specialtiesContainer) {
            specialtiesContainer.innerHTML = '';
            
            // Agrupar por categoria
            const categories = {
                hair: 'Cabelo',
                face: 'Rosto',
                nails: 'Unhas',
                body: 'Corpo'
            };
            
            // Criar um campo de checkbox para cada especialidade, agrupado por categoria
            Object.keys(categories).forEach(category => {
                const categoryServices = window.services.filter(service => service.category === category);
                
                if (categoryServices.length > 0) {
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'col-12 mt-2';
                    categoryTitle.innerHTML = `<strong>${categories[category]}</strong>`;
                    specialtiesContainer.appendChild(categoryTitle);
                    
                    categoryServices.forEach(service => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 col-sm-6 mb-2';
                        col.innerHTML = `
                            <div class="form-check">
                                <input class="form-check-input specialty-checkbox" type="checkbox" id="specialty-${service.id}" value="${service.id}">
                                <label class="form-check-label" for="specialty-${service.id}">${service.name}</label>
                            </div>
                        `;
                        specialtiesContainer.appendChild(col);
                    });
                }
            });
        }
        
        // Fazer o mesmo para o modal de edição
        const editSpecialtiesContainer = document.getElementById('editSpecialtiesContainer');
        if (editSpecialtiesContainer) {
            editSpecialtiesContainer.innerHTML = '';
            
            Object.keys(categories).forEach(category => {
                const categoryServices = window.services.filter(service => service.category === category);
                
                if (categoryServices.length > 0) {
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'col-12 mt-2';
                    categoryTitle.innerHTML = `<strong>${categories[category]}</strong>`;
                    editSpecialtiesContainer.appendChild(categoryTitle);
                    
                    categoryServices.forEach(service => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 col-sm-6 mb-2';
                        col.innerHTML = `
                            <div class="form-check">
                                <input class="form-check-input edit-specialty-checkbox" type="checkbox" id="edit-specialty-${service.id}" value="${service.id}">
                                <label class="form-check-label" for="edit-specialty-${service.id}">${service.name}</label>
                            </div>
                        `;
                        editSpecialtiesContainer.appendChild(col);
                    });
                }
            });
        }
        
        console.log('Especialidades carregadas.');
    }

    // Preencher a tabela de profissionais
    function populateProfessionalsTable() {
        const tableBody = document.querySelector('#professionalsTable tbody');
        if (!tableBody) return;
        
        // Limpar a tabela
        tableBody.innerHTML = '';
        
        // Filtros (se existirem)
        const filterName = document.getElementById('filterName')?.value.toLowerCase() || '';
        const filterCompany = document.getElementById('filterCompany')?.value || '';
        const filterSpecialty = document.getElementById('filterSpecialty')?.value || '';
        const filterStatus = document.getElementById('filterStatus')?.value || '';
        
        // Filtrar os profissionais
        let filteredProfessionals = window.professionals;
        
        if (filterName) {
            filteredProfessionals = filteredProfessionals.filter(pro => 
                pro.name.toLowerCase().includes(filterName) || 
                pro.email.toLowerCase().includes(filterName)
            );
        }
        
        if (filterCompany) {
            filteredProfessionals = filteredProfessionals.filter(pro => 
                pro.companyId.toString() === filterCompany
            );
        }
        
        if (filterSpecialty) {
            filteredProfessionals = filteredProfessionals.filter(pro => 
                pro.specialties.some(spec => spec.id.toString() === filterSpecialty)
            );
        }
        
        if (filterStatus) {
            filteredProfessionals = filteredProfessionals.filter(pro => 
                pro.status === filterStatus
            );
        }
        
        // Adicionar os profissionais à tabela
        filteredProfessionals.forEach(professional => {
            // Formatar as especialidades
            const specialties = professional.specialties.map(spec => spec.name).join(', ');
            
            // Formatar o status
            let statusBadge = '';
            switch (professional.status) {
                case 'active':
                    statusBadge = '<span class="badge bg-success">Ativo</span>';
                    break;
                case 'inactive':
                    statusBadge = '<span class="badge bg-danger">Inativo</span>';
                    break;
                case 'vacation':
                    statusBadge = '<span class="badge bg-warning text-dark">Em férias</span>';
                    break;
                default:
                    statusBadge = '<span class="badge bg-secondary">Indefinido</span>';
            }
            
            // Criar a linha da tabela
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${professional.id}</td>
                <td>${professional.name}</td>
                <td>${professional.companyName}</td>
                <td>${specialties}</td>
                <td>${professional.phone}</td>
                <td>${statusBadge}</td>
                <td>${professional.createdAt}</td>
                <td>
                    <button class="btn btn-sm btn-info view-professional" data-id="${professional.id}" title="Visualizar">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-primary edit-professional" data-id="${professional.id}" title="Editar">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger delete-professional" data-id="${professional.id}" title="Excluir">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            
            tableBody.appendChild(row);
        });
        
        // Adicionar eventos aos botões de ação
        setupTableActionButtons();
        
        console.log('Tabela de profissionais populada com', filteredProfessionals.length, 'registros.');
    }

    // Configurar os botões de ação na tabela
    function setupTableActionButtons() {
        // Botões de visualizar
        document.querySelectorAll('.view-professional').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                const professional = window.professionals.find(p => p.id === id);
                if (professional) {
                    // Em uma implementação real, você abriria um modal com mais detalhes
                    alert(`Visualizando profissional: ${professional.name}\nEmpresa: ${professional.companyName}\nEspecialidades: ${professional.specialties.map(s => s.name).join(', ')}`);
                }
            });
        });
        
        // Botões de editar
        document.querySelectorAll('.edit-professional').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                loadProfessionalForEditing(id);
            });
        });
        
        // Botões de excluir
        document.querySelectorAll('.delete-professional').forEach(btn => {
            btn.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                deleteProfessional(id);
            });
        });
    }

    // Configurar listeners de eventos
    function setupEventListeners() {
        // Botões de filtro
        document.getElementById('clearFiltersBtn')?.addEventListener('click', function() {
            document.getElementById('filterName').value = '';
            document.getElementById('filterCompany').value = '';
            document.getElementById('filterSpecialty').value = '';
            document.getElementById('filterStatus').value = '';
            populateProfessionalsTable();
        });
        
        document.getElementById('applyFiltersBtn')?.addEventListener('click', function() {
            populateProfessionalsTable();
        });
        
        // Botão para salvar novo profissional
        document.getElementById('saveProfessionalBtn')?.addEventListener('click', saveProfessional);
        
        // Botão para atualizar profissional
        document.getElementById('updateProfessionalBtn')?.addEventListener('click', updateProfessional);
        
        // Botão para adicionar especialidade (em uma implementação real, isso abriria um modal para criar nova especialidade)
        document.getElementById('addSpecialtyBtn')?.addEventListener('click', function() {
            alert('Funcionalidade para adicionar nova especialidade. Em uma implementação real, isso abriria um modal para criar uma nova especialidade no sistema.');
        });
        
        document.getElementById('editAddSpecialtyBtn')?.addEventListener('click', function() {
            alert('Funcionalidade para adicionar nova especialidade. Em uma implementação real, isso abriria um modal para criar uma nova especialidade no sistema.');
        });
    }

    // Salvar um novo profissional
    function saveProfessional() {
        const form = document.getElementById('professionalForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        // Verificar se foi selecionada pelo menos uma especialidade
        const selectedSpecialties = document.querySelectorAll('.specialty-checkbox:checked');
        if (selectedSpecialties.length === 0) {
            alert('Selecione pelo menos uma especialidade para o profissional!');
            return;
        }
        
        // Obter a empresa selecionada
        const companyId = parseInt(document.getElementById('professionalCompany').value);
        const companySelect = document.getElementById('professionalCompany');
        const companyName = companySelect.options[companySelect.selectedIndex].text;
        
        // Obter as especialidades selecionadas
        const specialties = [];
        selectedSpecialties.forEach(checkbox => {
            const specialtyId = parseInt(checkbox.value);
            const service = window.services.find(s => s.id === specialtyId);
            if (service) {
                specialties.push({ id: service.id, name: service.name });
            }
        });
        
        // Obter os horários de atendimento
        const workSchedule = {
            monday: {
                active: document.getElementById('workMonday').checked,
                start: document.getElementById('mondayStart').value,
                end: document.getElementById('mondayEnd').value
            },
            tuesday: {
                active: document.getElementById('workTuesday').checked,
                start: document.getElementById('tuesdayStart').value,
                end: document.getElementById('tuesdayEnd').value
            },
            wednesday: {
                active: document.getElementById('workWednesday').checked,
                start: document.getElementById('wednesdayStart').value,
                end: document.getElementById('wednesdayEnd').value
            },
            thursday: {
                active: document.getElementById('workThursday').checked,
                start: document.getElementById('thursdayStart').value,
                end: document.getElementById('thursdayEnd').value
            },
            friday: {
                active: document.getElementById('workFriday').checked,
                start: document.getElementById('fridayStart').value,
                end: document.getElementById('fridayEnd').value
            },
            saturday: {
                active: document.getElementById('workSaturday').checked,
                start: document.getElementById('saturdayStart').value,
                end: document.getElementById('saturdayEnd').value
            },
            sunday: {
                active: document.getElementById('workSunday').checked,
                start: document.getElementById('sundayStart').value,
                end: document.getElementById('sundayEnd').value
            }
        };
        
        // Gerar um novo ID (em um sistema real, isso seria gerado pelo backend)
        const newId = window.professionals.length > 0 ? Math.max(...window.professionals.map(p => p.id)) + 1 : 1001;
        
        // Criar o novo profissional
        const newProfessional = {
            id: newId,
            name: document.getElementById('professionalName').value,
            email: document.getElementById('professionalEmail').value,
            companyId: companyId,
            companyName: companyName,
            phone: document.getElementById('professionalPhone').value,
            status: document.getElementById('professionalStatus').value,
            document: document.getElementById('professionalDocument').value,
            specialties: specialties,
            description: document.getElementById('professionalDescription').value,
            workSchedule: workSchedule,
            photo: null, // Em uma implementação real, isso seria um upload de arquivo
            createdAt: new Date().toLocaleDateString('pt-BR')
        };
        
        // Adicionar o profissional à lista
        window.professionals.push(newProfessional);
        
        // Salvar no localStorage
        saveProfessionalsToStorage();
        
        // Atualizar a tabela
        populateProfessionalsTable();
        
        // Mostrar mensagem de sucesso
        alert(`Profissional ${newProfessional.name} cadastrado com sucesso!`);
        
        // Fechar o modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('addProfessionalModal'));
        modal.hide();
        
        // Limpar o formulário
        form.reset();
        
        // Desmarcar todas as especialidades
        document.querySelectorAll('.specialty-checkbox').forEach(checkbox => {
            checkbox.checked = false;
        });
    }

    // Carregar um profissional para edição
    function loadProfessionalForEditing(id) {
        const professional = window.professionals.find(p => p.id === id);
        if (!professional) {
            alert('Profissional não encontrado!');
            return;
        }
        
        // Preencher o formulário com os dados do profissional
        document.getElementById('editProfessionalId').value = professional.id;
        document.getElementById('editProfessionalName').value = professional.name;
        document.getElementById('editProfessionalEmail').value = professional.email;
        document.getElementById('editProfessionalCompany').value = professional.companyId;
        document.getElementById('editProfessionalPhone').value = professional.phone;
        document.getElementById('editProfessionalStatus').value = professional.status;
        document.getElementById('editProfessionalDocument').value = professional.document;
        document.getElementById('editProfessionalDescription').value = professional.description;
        
        // Marcar as especialidades do profissional
        document.querySelectorAll('.edit-specialty-checkbox').forEach(checkbox => {
            checkbox.checked = false; // Primeiro desmarca todas
        });
        
        professional.specialties.forEach(specialty => {
            const checkbox = document.getElementById(`edit-specialty-${specialty.id}`);
            if (checkbox) {
                checkbox.checked = true;
            }
        });
        
        // Configurar os horários de atendimento
        document.getElementById('editWorkMonday').checked = professional.workSchedule.monday.active;
        document.getElementById('editMondayStart').value = professional.workSchedule.monday.start;
        document.getElementById('editMondayEnd').value = professional.workSchedule.monday.end;
        
        // Abrir o modal
        const modal = new bootstrap.Modal(document.getElementById('editProfessionalModal'));
        modal.show();
    }

    // Atualizar um profissional
    function updateProfessional() {
        const form = document.getElementById('editProfessionalForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        // Verificar se foi selecionada pelo menos uma especialidade
        const selectedSpecialties = document.querySelectorAll('.edit-specialty-checkbox:checked');
        if (selectedSpecialties.length === 0) {
            alert('Selecione pelo menos uma especialidade para o profissional!');
            return;
        }
        
        const professionalId = parseInt(document.getElementById('editProfessionalId').value);
        const professionalIndex = window.professionals.findIndex(p => p.id === professionalId);
        
        if (professionalIndex === -1) {
            alert('Profissional não encontrado!');
            return;
        }
        
        // Obter a empresa selecionada
        const companyId = parseInt(document.getElementById('editProfessionalCompany').value);
        const companySelect = document.getElementById('editProfessionalCompany');
        const companyName = companySelect.options[companySelect.selectedIndex].text;
        
        // Obter as especialidades selecionadas
        const specialties = [];
        selectedSpecialties.forEach(checkbox => {
            const specialtyId = parseInt(checkbox.value);
            const service = window.services.find(s => s.id === specialtyId);
            if (service) {
                specialties.push({ id: service.id, name: service.name });
            }
        });
        
        // Atualizar o profissional
        const updatedProfessional = {
            ...window.professionals[professionalIndex],
            name: document.getElementById('editProfessionalName').value,
            email: document.getElementById('editProfessionalEmail').value,
            companyId: companyId,
            companyName: companyName,
            phone: document.getElementById('editProfessionalPhone').value,
            status: document.getElementById('editProfessionalStatus').value,
            document: document.getElementById('editProfessionalDocument').value,
            specialties: specialties,
            description: document.getElementById('editProfessionalDescription').value
        };
        
        // Atualizar o profissional na lista
        window.professionals[professionalIndex] = updatedProfessional;
        
        // Salvar no localStorage
        saveProfessionalsToStorage();
        
        // Atualizar a tabela
        populateProfessionalsTable();
        
        // Mostrar mensagem de sucesso
        alert(`Profissional ${updatedProfessional.name} atualizado com sucesso!`);
        
        // Fechar o modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('editProfessionalModal'));
        modal.hide();
    }

    // Excluir um profissional
    function deleteProfessional(id) {
        if (!confirm('Tem certeza que deseja excluir este profissional?')) {
            return;
        }
        
        const professionalIndex = window.professionals.findIndex(p => p.id === id);
        if (professionalIndex === -1) {
            alert('Profissional não encontrado!');
            return;
        }
        
        const professional = window.professionals[professionalIndex];
        
        // Remover da lista
        window.professionals.splice(professionalIndex, 1);
        
        // Salvar no localStorage
        saveProfessionalsToStorage();
        
        // Atualizar a tabela
        populateProfessionalsTable();
        
        // Mostrar mensagem de sucesso
        alert(`Profissional ${professional.name} excluído com sucesso!`);
    }
</script> 